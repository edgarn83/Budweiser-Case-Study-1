---
title: "Budwiser Case Study 01 by Megan R. and Egar N."
author: "Edgar Nunez and Megan Riley"
date: "10/5/2019"
output: html_document
---

```{r setup, warnings = FALSE, cache=TRUE}
#Loading Libraries
library(tidyverse)
library(ggplot2)
library(GGally)
library(dplyr)

knitr::opts_chunk$set(echo = TRUE)

# Read in data
BeersData = read_csv("Beers.csv")
BreweriesData = read_csv("Breweries.csv")


```

###Clean the data (listwise deletion of of observations when AVS is NA)
```{r}
#newdata <- na.omit(mydata)

```


Below are the first passes at running the analysis for the EDA.  

###Analysis Question One

```{r warnings = FALSE}
#How Many Breweries in Each State? 
library(tidyverse)
#At the moment the file wont knit without reloading tidyverse here
#Should find a permanent fix for the final rmd presentation.
BreweriesData %>% group_by(State) %>% summarise(n = n())


```

###Analysis Question Two

```{r warnings = FALSE, cache=TRUE}
#Merge the Data 
BeerWithBreweries = merge(BeersData,BreweriesData, by.x = "Brewery_id", by.y = "Brew_ID")
colnames(BeerWithBreweries)[colnames(BeerWithBreweries)=="Name.x"] <- "Beer_Name"
colnames(BeerWithBreweries)[colnames(BeerWithBreweries)=="Name.y"] <- "Brewery_Name"


```


###Analysis Question Three

```{r warnings = FALSE}
#Address the Missing Values in Each Column

lmibu = lm(BeersData$IBU ~BeersData$ABV, data = BeersData)
BeersData1 = BeersData %>% filter(!is.na(ABV) & is.na(IBU))
#predict(lmibu, BeersData1[,3])


#BeersData1$ImputeIBU = BeersData1$IBU 

#Address the Missing Values in Each Column

lmibu = lm(BeersData$IBU ~BeersData$ABV + BeersData$Brewery_id, data = BeersData)
BeersData2 = BeersData
BeersData1 = BeersData %>% filter(!is.na(ABV) & is.na(IBU))
BeersData2$IBU = predict(lmibu,BeersData[,4])

summary(lmibu)
BeersData3 <- sqldf("SELECT Name, Beer_ID, ABV, IFNULL(IBU, 0) as IBU, Brewery_id, Style, Ounces FROM BeersData")

BeersData4 <- sqldf("UPDATE BeersData3
SET IBU = BeersData2.IBU
FROM BeersData2
WHERE BeersData3.IBU = 0 and BeersData3.Beer_ID = BeersData2.Beer_ID")

sqldf("select BeersData3.Name, BeersData3.Beer_ID, BeersData3.ABV, BeersData3.IBU, BeersData3.Brewery_id, BeersData3.Style, BeersData3.Ounces, BeersData2.IBU
from BeersData3 INNER JOIN BeersData2 BeersData2 INNER JOIN BeersData2 on BeersData3.IBU = 0 and BeersData3.Beer_ID = BeersData2.Beer_ID")

BeersData3 <- sqldf("SELECT * FROM BeersData WHERE BeersData.ABV != 'NA' and BeersData.IBU != 'NA'")

BeersData2 = merge(BeersData1,predictedIBU, by.x = "Beer_ID", all.y = "Beer_ID")

DF1$Activity <- ifelse(DF2$NAME == DF1$NAME, DF2$Activity, NA)


```

###Analysis Question Four

```{r}
library(ggthemes)
MedianABV = BeerWithBreweries %>% group_by(State) %>% summarise(MedABV = median(ABV, na.rm = TRUE))
MedianABV %>% ggplot(aes(x = State, y = MedABV)) + geom_bar(stat = "identity", fill = "light green") +
  ylab("Median ABV") + ggtitle("Median Beer ABV by State") + theme_clean()

MedianIBU = BeerWithBreweries %>% group_by(State) %>% summarise(MedIBU = median(IBU, na.rm = TRUE))
MedianIBU %>% ggplot(aes(x = State, y = MedIBU)) + geom_bar(stat = "identity", fill = "light blue")+
  ylab("Median State IBU") + ggtitle("Median Beer IBU by State") + theme_clean()




```



###Analysis Question Five

```{r warnings = FALSE}
#Which state has the maximum ABV beer. 
ABVMax = which.max(BeerWithBreweries$ABV)
print(BeerWithBreweries[ABVMax,c(4,8,10)])

#Which state has the most bitter IBU beer? 
IBUMax = which.max(BeerWithBreweries$IBU)
print(BeerWithBreweries[IBUMax,c(5,8,10)])

```

###Analysis Question Six

```{r warnings = FALSE, message=FALSE}
#Summary Statistics and Distribution of the ABV variable
BeersData %>% ggplot(aes(x = ABV)) + geom_histogram(stat = "count")
summary(BeersData$ABV)



```

###Analysis Question Seven

```{r warnings = FALSE}
#Relationship betwen the bitterness of the beer and its alcoholic content, Scaatter plot and discussing 
BeersData %>% ggplot(aes(x = ABV, y = IBU, color = as.factor(Ounces))) + geom_point() +
  ggtitle("Beer IBU by ABV colored by Ounces")


```
