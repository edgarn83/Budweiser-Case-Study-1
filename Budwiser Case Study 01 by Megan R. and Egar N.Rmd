---
title: "Budwiser Case Study 01 by Megan R. and Egar N."
author: "Edgar Nunez and Megan Riley"
date: "10/5/2019"
output: html_document
---

```{r setup, warnings = FALSE, cache=TRUE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("sqldf")

#Loading Libraries
library(sqldf)
library(tidyverse)
library(ggplot2)
library(GGally)
library(dplyr)

knitr::opts_chunk$set(echo = TRUE)

# Read in data
BeersData = read_csv("Beers.csv")
BreweriesData = read_csv("Breweries.csv")


```


##Here we present a breakdown of the number of breweries in each state

```{r warnings = FALSE}
#How Many Breweries in Each State? 
library(tidyverse)
#At the moment the file wont knit without reloading tidyverse here
#Should find a permanent fix for the final rmd presentation.
BreweriesData %>% group_by(State) %>% summarise(n = n())


```

###Here we present a consolidated view of the beer data with the breweries data

```{r warnings = FALSE, cache=TRUE}
#Merge the Data 
BeerWithBreweries = merge(BeersData,BreweriesData, by.x = "Brewery_id", by.y = "Brew_ID")
colnames(BeerWithBreweries)[colnames(BeerWithBreweries)=="Name.x"] <- "Beer_Name"
colnames(BeerWithBreweries)[colnames(BeerWithBreweries)=="Name.y"] <- "Brewery_Name"

```

## The first order of business once we have a clean data set is to discover what we can about this data.  We use exploratory data analysis for this purpose.
```{r eda, include=TRUE}
# Look at some possible associations between variables
ggplot(BeersData, aes(x = ABV, y = IBU)) +
  geom_point () +
  geom_smooth (method='lm') +
  labs (
    title = "ABV and IBU relationship",
    subtitle = "Strong Positive Correlation - Needs Transformation",
    x = "ABV",
    y = "IBU")

ggplot(BeersData, aes(x = Style, y = IBU)) +
  geom_point () +
  geom_smooth () +
  labs (
    title = "Style and IBU relationship",
    subtitle = "No apparent Correlation",
    x = "Style",
    y = "IBU")

ggplot(BeersData, aes(x = Brewery_id, y = IBU)) +
  geom_point () +
  geom_smooth () +
  labs (
    title = "Brewery ID and IBU relationship",
    subtitle = "Low linear Correlation - No Transformation required",
    x = "Brewery ID",
    y = "IBU")

ggplot(BeersData, aes(x = Beer_ID, y = IBU)) +
  geom_point () +
  geom_smooth () +
  labs (
    title = "Beer ID and IBU relationship",
    subtitle = "Low Correlation - Needs Transformation",
    x = "Beer_ID",
    y = "IBU")

ggplot(BeersData, aes(x = Ounces, y = IBU)) +
  geom_point () +
  geom_smooth () +
  labs (
    title = "Ounces and IBU relationship",
    subtitle = "No apparent Correlation",
    x = "Ounces",
    y = "IBU")

ggplot(BeersData, aes(x = Name, y = IBU)) +
  geom_point () +
  geom_smooth () +
  labs (
    title = "Name and IBU relationship",
    subtitle = "No apparent Correlation",
    x = "Name",
    y = "IBU")

```

### Based on this analysis,IBU has a linear relationship with ABV. However, there is unequal variance in between beers' IBU with lower and higher ABV.

### To address the Missing Values in each Column we chose to impute the NA value with the median of the existing variables, because IBU showed a strong positive correlation with BVA.

```{r warnings = FALSE}
#Address the Missing Values in Each Column

lmibu = lm(BeersData$IBU ~BeersData$ABV, data = BeersData)
#BeersData1 = BeersData %>% filter(!is.na(ABV) & is.na(IBU))
BeersData$predictIBU = predict(lmibu,BeersData[,4])

#Address the Missing Values in Each Column

for(i in length(BeersData$IBU)){
  if(is.na(BeersData$IBU[i])){
  BeersData$IBU[i] <- BeersData$predictIBU[i]
  }
}

```

```{r}
#Calculate the Median for IBU and BVA
Medean.IBU <- median(BeersData$IBU, na.rm = TRUE)
Median.ABV <- median(BeersData$ABV, na.rm = TRUE) 

#Replace the NAs with the respective Medians
BeersData$IBU[is.na(BeersData)]=Medean.IBU
BeersData$ABV[is.na(BeersData$ABV)]=Median.ABV 

for(i in length(BeersData$IBU)){
  if(is.na(BeersData$IBU[i])){
  BeersData$IBU[i] <- Medean.IBU
  }
}

for(i in length(BeersData$ABV)){
  if(is.na(BeersData$ABV[i])){
  BeersData$ABV[i] <- Medean.IBU
  }
}

BeersData$IBU[1] <- Medean.IBU

#Verify NAs have been replaced
Beersdf1 <- data.frame(BeersData %>% filter(is.na(IBU)))
Beersdf1
Beersdf.ABV_NA <- data.frame(BeersData %>% filter(is.na(ABV)))
Beersdf.ABV_NA

BeersData

```

### Comparison of the median alcohol content and international bitterness unit (IBU) for each state

```{r}
library(ggthemes)
MedianABV = BeerWithBreweries %>% group_by(State) %>% summarise(MedABV = median(ABV, na.rm = TRUE))
MedianABV %>% ggplot(aes(x = State, y = MedABV)) + geom_bar(stat = "identity", fill = "light green") +
  ylab("Median ABV") + ggtitle("Median Beer ABV by State") + theme_clean()

MedianIBU = BeerWithBreweries %>% group_by(State) %>% summarise(MedIBU = median(IBU, na.rm = TRUE))
MedianIBU %>% ggplot(aes(x = State, y = MedIBU)) + geom_bar(stat = "identity", fill = "light blue")+
  ylab("Median State IBU") + ggtitle("Median Beer IBU by State") + theme_clean()

```



### State with the maximum alcoholic (ABV) beer and state with the most bitter (IBU) beer

```{r warnings = FALSE}
#Which state has the maximum ABV beer. 
ABVMax = which.max(BeerWithBreweries$ABV)
print(BeerWithBreweries[ABVMax,c(4,8,10)])

#Which state has the most bitter IBU beer? 
IBUMax = which.max(BeerWithBreweries$IBU)
print(BeerWithBreweries[IBUMax,c(5,8,10)])

```

### Summary statistics and distribution of the ABV

```{r warnings = FALSE, message=FALSE}
#Summary Statistics and Distribution of the ABV variable
BeersData %>% ggplot(aes(x = ABV)) + geom_histogram(stat = "count")
summary(BeersData$ABV)

```

### The is an apparent strong positive correlation between the bitterness of the beer and its alcoholic content

```{r warnings = FALSE}
#Relationship betwen the bitterness of the beer and its alcoholic content, Scaatter plot and discussing 
BeersData %>% ggplot(aes(x = ABV, y = IBU, color = as.factor(Ounces))) + geom_point() +
  ggtitle("Beer IBU by ABV colored by Ounces")

```
>>>>>>> Stashed changes
